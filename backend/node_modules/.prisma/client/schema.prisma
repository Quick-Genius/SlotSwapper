datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        Int           @id @default(autoincrement())
  name      String
  email     String        @unique
  password  String // hashed
  events    Event[]
  outgoing  SwapRequest[] @relation("outgoingRequests")
  incoming  SwapRequest[] @relation("incomingRequests")
  createdAt DateTime      @default(now())
}

model Event {
  id                Int           @id @default(autoincrement())
  title             String
  startTime         DateTime
  endTime           DateTime
  status            EventStatus   @default(BUSY)
  ownerId           Int
  owner             User          @relation(fields: [ownerId], references: [id])
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  mySwapRequests    SwapRequest[] @relation("myEventSwaps")
  theirSwapRequests SwapRequest[] @relation("theirEventSwaps")
}

enum EventStatus {
  BUSY
  SWAPPABLE
  SWAP_PENDING
}

model SwapRequest {
  id           Int        @id @default(autoincrement())
  proposerId   Int
  responderId  Int
  myEventId    Int // proposer's offered event
  theirEventId Int // responder's event being requested
  status       SwapStatus @default(PENDING)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  proposer   User  @relation("outgoingRequests", fields: [proposerId], references: [id])
  responder  User  @relation("incomingRequests", fields: [responderId], references: [id])
  myEvent    Event @relation("myEventSwaps", fields: [myEventId], references: [id])
  theirEvent Event @relation("theirEventSwaps", fields: [theirEventId], references: [id])
}

enum SwapStatus {
  PENDING
  ACCEPTED
  REJECTED
}
